## VPC

### ネットワークの基礎

#### CIDR

* IPアドレス + サブネットマスク = IPの範囲
* 10.0.1.0/16 (IPアドレス / サブネットマスク)
* IPアドレス (0~255) 4つ 各桁が8つのバイナリ値

#### OSI参照モデル
* TCP/IPモデル

#### ポート番号
* 通信の出入り口 集合住宅のメールボックスのような役割



### サブネット

* 左からX桁固定...ネットワーク部
* それ以降は自由...ホスト部
* 上限: 1リージョンあたり200サブネット
* プライベートサブネットに設置されたインスタンスからのインターネット接続
  * プライベートサブネット→NATゲートウェイで変換→インターネットゲートウェイ

### NAT (ネットワークアドレス変換)

* グローバルIPアドレスとプライベートIPアドレスを対応づけ
* NATゲートウェイ
  * プライベートサブネットが外部と通信可能になる

### IPマスカレード

* 複数のプライベートIPアドレスを一つのグローバルIPアドレスに対応づけ

### セキュリティグループ

* サーバ単位(インスタンスレベル)でトラフィック制御
* ステートフル

### ネットワークACL

* VPC/サブネットに対するトラフィック制御
* ステートレス
* 上から順(低い値から高い値)にルール適用 設定され次第即反映

### VPCエンドポイント

* グローバルIPアドレスをもつAWSサービスに対し、VPC内から(インターネットを介さず)直接アクセスできる

  * Gateway型: ルートテーブルの指定されたターゲットとなるゲートウェイ
    * サポート: Amazon S3, DynamoDB
  * Privatelink型: 対象サービスをあて先とするトラフィックのエントリポイントとなるプライベートIPアドレスを持つElastic Network Interface
  * サポート: API Gateway, CloudWatch, etc...

* アクセスするにはエンドポイントのリージョン指定が必要

  ```
   $ aws s3 ls // アクセスできず
   $ aws s3 --region ap-northeast-1 // アクセス可能
  ```

  

### [共有VPC](https://docs.aws.amazon.com/ja_jp/vpc/latest/userguide/vpc-sharing.html)

* 複数のAWSアカウントでアプリケーションリソースをVPC内に作成できる
* グループ会社や事業部単位で複数のAWSアカウントを利用するケースに最適

### Accelerated VPN connection

* オンプレミスネットワークから利用者のゲートウェイデバイスに最も近いAWSエッジロケーションにトラフィックをルーティング

### VPCでのVPN接続

* カスタマーゲートウェイに静的ルートテーブルを構成

### VPCフローログ

* EC2インスタンスとネットワークインターフェース間を往来するIPトラフィック情報をキャプチャできる